<div class="wrapper">
  <%= render "devise/shared/header" %>

  <%= form_with model: @debttable, url: create_assettable_and_debttable_path, class: 'registration-main', local: true do |f| %>
    <table class="table">
      <thead>
        <tr>
          <th>勘定科目</th>
          <th>残高</th>
        </tr>
      </thead>
      <tbody class="bulk-registration-form">   
      <%= f.fields_for :debttables do |d_field| %>
          <tr class="item">
            <td class="list_field_box">
              <%= d_field.collection_select :list_id, List.where(code: 200..299), :id, :code_name, { prompt: "選択してください" }, class: "form-select form-select-sm"  %>
            </td>
            <td class="balance_field_box">
              <%= d_field.text_field :balance, placeholder: "例) 1000"%>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>

    <%= f.submit "登録", class: "btn btn-outline-secondary", onclick: "return checkProperites()"%>
  <% end %>

</div>

<script>
  //勘定項目か残高が入力されていない場合はアラートを出す
  const checkProperites = function() {
    let list_fields = document.getElementsByClassName("list_field_box")
    let balance_fields = document.getElementsByClassName("balance_field_box")
    for(i=0; i < list_fields.length; i++) {
      target_list_field = list_fields[i]
      target_balance_field = balance_fields[i]
      if ((target_list_field.childNodes[1].options.selectedIndex == 0 && target_balance_field.childNodes[1].value) || (target_list_field.childNodes[1].options.selectedIndex >= 1 && target_balance_field.childNodes[1].value == "")) {
        alert(`エラー ${i+1}行の勘定科目or残高が入力されていません。`)
        return false
      }
    }
  }
</script>